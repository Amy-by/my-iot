**08 文件夹级别目录树结构**

**目录树结构**

  --------------------------------------------------------------
  my-iot/\
  ├── src/\
  │ ├── main/\
  │ │ ├── java/com/ruoyi/\
  │ │ │ ├── iot/ \# IoT核心功能模块（新增）\
  │ │ │ │ ├── controller/ \# 传感器、报警、通知、日志等接口控制器\
  │ │ │ │ ├── service/ \# 业务逻辑层\
  │ │ │ │ │ ├── sensor/ \# 传感器管理相关接口\
  │ │ │ │ │ │ └── impl/ \# 传感器管理实现\
  │ │ │ │ │ ├── alarm/ \# 报警处理相关接口\
  │ │ │ │ │ │ └── impl/ \# 报警处理实现\
  │ │ │ │ │ └── notification/ \# 通知下发相关接口\
  │ │ │ │ │     └── impl/ \# 通知下发实现\
  │ │ │ │ ├── model/ \# 数据模型（传感器、报警日志、通知额度等实体类）\
  │ │ │ │ ├── mapper/ \# 数据库访问层（新增表的MyBatis映射）\
  │ │ │ │ ├── protocol/ \# 协议处理\
  │ │ │ │ │ └── v1/ \# Cat1协议v1版本（帧解析、TLV规则适配，适配JTY-GD-TCN2010）\
  │ │ │ │ │     └── tlv-dynamic-loader/ \# TLV规则动态加载（第二次更改新增）\
  │ │ │ │ ├── netty/ \# Netty通信核心逻辑（新增）\
  │ │ │ │ │ ├── handler/ \# 帧解码、业务处理Handler（新增）\
  │ │ │ │ │ ├── server/ \# Netty服务启动与连接管理（新增）\
  │ │ │ │ │ └── websocket/ \# WebSocket推送服务（报警/状态实时推送）\
  │ │ │ │ ├── simulator/ \# 传感器模拟器核心逻辑（如协议帧生成、参数调整，新增说明）\
  │ │ │ │ ├── util/ \# IoT模块专用工具类（如帧校验、额度计算）\
  │ │ │ │ │ ├── frame-crypto/ \# 协议帧加密/解密工具（第二次更改新增）\
  │ │ │ │ │ └── code-gen/ \# IoT模块专用代码生成工具类（第三次更改新增）\
  │ │ │ │ └── metrics/ \# 监控指标采集（设备连接数、消息吞吐量等）\
  │ │ │ ├── config/iot/ \# IoT模块配置（Netty连接、缓存策略、Prometheus集成等，新增说明）\
  │ │ │ └── common/iot/ \# 公共组件（异常处理、常量定义）\
  │ │ └── resources/\
  │ │   ├── mapper/iot/ \# IoT模块MyBatis映射文件\
  │ │   └── iot/ \# 细分资源文件（新增细分）\
  │ │       ├── protocol/ \# 各版本协议规则（新增）\
  │ │       │   └── v1/ \# Cat1 v1协议相关配置\
  │ │       │       └── encryption-config.yaml \# 加密算法参数配置（第二次更改新增）\
  │ │       ├── simulator/ \# 模拟器配置（新增）\
  │ │       ├── metrics/ \# 监控指标配置（新增）\
  │ │       └── config/ \# 新增：配置文件汇总（第三次更改新增）\
  │ │           └── dependencies/ \# 依赖版本配置（第三次更改新增）\
  │ ├── sql/\
  │ │ └── iot/ \# 新增表结构与数据脚本\
  │ │     ├── init/ \# 初始化数据脚本（默认额度、字典数据等）\
  │ │     └── upgrade/ \# 版本升级脚本（新增）\
  │ └── web/\
  │   ├── views/iot/ \# 前端页面（设备列表、报警监控、通知额度管理等，路径以/iot/开头，新增说明）\
  │   ├── components/iot/ \# 专用组件\
  │   │   ├── docs/ \# 组件文档（使用示例、参数说明）\
  │   │   ├── chart/ \# IoT专用数据可视化组件（第二次更改新增）\
  │   │   └── form/ \# 表单相关组件（第三次更改新增）\
  │   ├── api/iot/ \# 前端接口请求（对接后端IoT接口）\
  │   ├── router/iot/ \# 前端路由配置（传感器、报警等页面路由）\
  │   └── store/iot/ \# 前端状态管理（使用Pinia）\
  │       └── modules/ \# 按业务域拆分的状态模块（第二次更改新增）\
  ├── docs/ \# 新增：IoT模块补充文档（可选，细化开发文档）\
  │   ├── api/ \# 接口文档（第二次更改新增）\
  │   └── changelog/ \# 版本更新日志（第三次更改新增）\
  └── simulator/ \# 传感器模拟器独立运行模块（仅含入口与配置，依赖iot/simulator逻辑，新增说明）\
      ├── config/ \# 模拟器基础配置（如默认上报间隔、温度范围）\
      ├── scenes/ \# 预定义模拟场景脚本（对应07号文档的场景清单）\
      │   └── dynamic-adjust/ \# 参数动态调整场景脚本（第二次更改新增）\
      └── script/ \# 启动脚本（依赖iot/util工具类）

  --------------------------------------------------------------

**目录说明：**

**核心原则**：所有新增功能均在独立目录中实现，不修改原有ruoyi-admin、ruoyi-system等模块，符合"对增加开放、对修改关闭"的设计思想，避免影响原有系统稳定性。

**后端模块（src/main/java/com/ruoyi/iot/）**

controller/：对外提供HTTP接口，接收前端请求（如设备列表查询、报警处理指令、日志查询导出、额度查询）。

service/：核心业务逻辑层，按业务域拆分：
- sensor/：传感器接入管理（设备注册、在线状态维护）
- alarm/：报警处理（规则判断、优先级排序）
- notification/：通知下发（额度校验、第三方接口调用）

model/：存放实体类，对应数据库表（如Sensor、AlarmLog、NotificationQuota）和协议帧结构（如Cat1Frame）。

protocol/：按协议版本划分，v1目录专门处理Cat1 v1协议，包括帧解析（包头0x7E、CRC校验）、TLV格式转换，适配JTY-GD-TCN2010传感器的数据格式；新增版本可扩展v2等目录。

netty/：Netty通信核心层（新增）：
- handler/：负责帧解码（基于0x7E包头/CRC校验）、业务消息分发（如注册/报警消息）；
- server/：包含Netty服务启动、端口配置、连接管理的核心类，实现高并发设备接入。
- websocket/：封装WebSocket推送（报警弹窗、状态变更）服务实现。

metrics/：监控指标采集逻辑（如Netty连接数统计、报警频率计数），支持Prometheus集成。

simulator/：传感器模拟器核心逻辑（修改说明），包括模拟数据生成、协议帧构造、参数动态调整（如烟雾浓度、上报间隔），供独立模拟器模块依赖。

util/：IoT模块专用工具类，新增code-gen/子目录用于存放IoT模块专用代码生成工具类（如传感器表结构生成、协议帧模板生成），适配代码生成功能的多次优化需求。

**数据存储相关**

src/main/resources/mapper/iot/：存放新增表的MyBatis XML映射文件，与iot/mapper/接口对应。

src/main/resources/iot/：细分资源文件（修改说明）：
- protocol/：存放各版本协议规则（如v1/frame-structure.json、v1/tlv-mapping.xml）；
- simulator/：模拟器配置（如default-params.yaml、scene-templates/）；
- metrics/：监控指标配置（如prometheus-rules.yml）；
- config/dependencies/：存放依赖版本配置文件（如version.properties），集中管理druid、fastjson等组件的版本信息，适配多次依赖升级场景。

src/sql/iot/：包含表结构脚本（与06、07号文档的表结构设计对应）、init子目录（初始化数据脚本，如通知额度默认配置）和upgrade子目录：按版本号（如V1.1__add_sensor_field.sql）存放增量升级脚本，配合Flyway实现自动化升级。

**前端模块（src/web/）**

views/iot/：新增页面（修改说明），如"传感器列表""实时报警监控""通知额度管理"等，路径均以/iot/开头（如/iot/quota），基于Vue3+Element Plus开发。

components/iot/：复用性组件，新增form/子目录存放表单相关组件（如传感器参数表单、报警规则表单），适配表单构建、防重复提交等功能优化；docs子目录存放组件文档（使用示例、Props、事件说明）；chart/子目录存放数据可视化组件。

api/iot/：封装后端IoT接口的请求函数，统一管理接口地址和参数。

router/iot/：IoT模块路由配置文件，通过路由懒加载注册页面，支持URL访问。

store/iot/：使用Pinia管理IoT相关的全局状态，modules/子目录按业务域拆分状态模块，提升可维护性。

**模拟器独立模块（simulator/）**

单独隔离的模拟器独立运行入口（修改说明），支持脱离主系统独立运行，核心逻辑依赖iot/simulator（避免代码重复）。

config/：模拟器基础配置（如默认上报间隔、温度范围）。

scenes/：预定义模拟场景脚本，dynamic-adjust/子目录存放参数动态调整类场景脚本。

**扩展性设计**

新增传感器类型时，在protocol/下新增对应版本目录（如v2/）添加解析规则，在model/中扩展实体类，无需修改原有逻辑。

新增通知渠道（如微信推送）时，在service/notification/impl/中新增实现类，通过接口抽象保证兼容性。

目录按"功能职责+业务域"划分，结构清晰，新人可快速定位代码位置。

**版本更改说明：第一次更改**
1. 新增`iot/netty/`目录及子目录`handler/`、`server/`，原因：明确Netty通信层与业务层边界，避免通信逻辑分散；
2. 细分`src/main/resources/iot/`为`protocol/`、`simulator/`、`metrics/`，原因：避免资源文件命名冲突，提升配置管理清晰度；
3. 在`src/sql/iot/`下新增`upgrade/`目录，原因：支持表结构迭代的增量升级，避免反复修改初始化脚本；
4. 调整`iot/simulator/`说明为“传感器模拟器核心逻辑”，根目录`simulator/`说明为“独立运行模块（依赖核心逻辑）”，原因：明确两者职责，避免代码冗余；
5. 补充`config/iot/`说明包含“Prometheus集成配置”，原因：明确监控指标配置位置，提升可维护性；
6. 补充`views/iot/`说明页面路径以`/iot/`开头，原因：确保IoT模块前端页面与原有模块隔离，符合“对修改关闭”原则。

**版本更改说明：第二次更改**
1. 新增`iot/protocol/v1/tlv-dynamic-loader/`目录，原因：支持TLV规则的配置化动态加载（无需重启服务即可更新字段映射关系），适配传感器型号迭代时的协议规则微调，提升协议适配灵活性；
2. 新增`iot/util/frame-crypto/`子目录及工具类，原因：补充协议帧加密/解密能力（支持AES-128、DES等算法），适配部分场景下传感器数据的加密传输需求，强化数据传输安全性；
3. 在`src/main/resources/iot/protocol/v1/`下新增`encryption-config.yaml`文件，原因：集中存储加密算法参数（密钥、加密模式、填充方式），与`frame-crypto`工具类联动，实现加密配置的可配置化管理，避免硬编码；
4. 新增`web/components/iot/chart/`子目录，原因：存放IoT模块专用数据可视化组件（如设备在线率折线图、报警类型饼图、传感器数据时序图），复用可视化逻辑，提升前端页面开发效率；
5. 在`simulator/scenes/`下新增`dynamic-adjust/`子目录，原因：存放参数动态调整类场景脚本（如“环境温度超阈值时自动提升上报频率”“低电量时降低数据精度”），丰富模拟场景维度，贴合实际设备运行工况；
6. 新增`docs/api/`子目录，原因：存放IoT模块HTTP接口文档（含Swagger导出HTML、接口参数说明、响应示例），以及Netty通信协议交互手册，降低前后端对接成本和后期维护门槛；
7. 补充`web/store/iot/modules/`子目录，原因：按业务域拆分Pinia状态模块（如`sensor.js`管理设备状态、`alarm.js`管理报警状态），避免单一状态文件过于庞大，提升前端状态管理的可维护性。

**版本更改说明：第三次更改**
1. 新增`iot/util/code-gen/`子目录，原因：集中存放IoT模块专用代码生成工具类（如传感器表结构生成、协议帧模板生成），适配代码生成功能的多次优化（如主子表支持、字典类型处理），提升代码生成逻辑的独立性和可维护性；
2. 在`src/main/resources/iot/config/`下新增`dependencies/`子目录，原因：存放依赖版本配置文件（如version.properties），集中管理druid、fastjson、element-ui等组件的版本信息，适配多次依赖升级场景，避免版本信息分散；
3. 新增`web/components/iot/form/`子目录，原因：存放表单相关组件（如传感器参数表单、报警规则表单），适配表单构建、防重复提交、字段校验等功能优化，提升表单组件的复用性；
4. 新增`docs/changelog/`子目录，原因：存放各版本更新日志（对应views/index.vue中的版本记录），系统梳理功能迭代历史，方便开发人员追溯变更内容和原因。

**更改核心原则**：所有新增内容均基于原有目录结构扩展，未修改任何第一次、第二次更改后的目录结构和核心逻辑，继续遵循“对增加开放、对修改关闭”原则，确保新增功能与现有模块兼容，不影响系统稳定性和可扩展性。